<?xml version="1.0" encoding="UTF-8"?>
<odoo>

        <record id="view_dmpi_crm_sale_contract_customer_search" model="ir.ui.view">
            <field name="name">CRM Sale Contract</field>
            <field name="model">dmpi.crm.sale.contract</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name"/>
                    <field name="sap_cn_no"/>
                    <field name="partner_id"/>
                    <field name="customer_ref"/>
                </search>
            </field>
        </record>

        <record id="view_dmpi_crm_sale_contract_customer_tree" model="ir.ui.view">
            <field name="name">CRM Sale Contract</field>
            <field name="model">dmpi.crm.sale.contract</field>
            <field name="arch" type="xml">
                <tree decoration-muted="state == 'cancel' ">
                    <field name="name"/>
                    <field name="sap_cn_no"/>
                    <field name="week_no" required="1"/>
                    <field name="partner_id"/>
                    <field name="contract_type" invisible="1"/>
                    <field name="customer_ref" />
                    <field name="po_date"/>
                    <field name="valid_from" />
                    <field name="valid_to"/>   
                    <field name="state"/>     
                </tree>
            </field>
        </record>



        <record id="view_dmpi_crm_sale_contract_customer_form" model="ir.ui.view">
            <field name="name">CRM Sale Contract</field>
            <field name="model">dmpi.crm.sale.contract</field>
            <field name="arch" type="xml">
                <form class="o_form_document">
                    <header>

                        <button name="action_submit_contract" states="draft" string="Submit Contract" type="object" class="oe_highlight" groups="base.group_user" confirm="Please confirm PO Submission"/>


                        <field name="state" widget="statusbar" statusbar_visible="draft,submitted,enroute,received" statusbar_colors='{"approved":"blue"}'/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="upload_wizard"
                                type="object"
                                string="Upload"
                                class="oe_stat_button"
                                icon="fa-upload">
                            </button>
                        </div>


                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>

                        <group>
                            <group>
                                <field name="partner_id" options="{'no_quick_create':True,'no_create_edit':True, 'no_open': True}" attrs="{'readonly': [('state', 'not in', ['draft'])]}" required="1"/>
                                <field name="customer_ref" attrs="{'readonly': [('state', 'not in', ['draft'])]}" />
                                <field name="po_date" attrs="{'readonly': [('state', 'not in', ['draft'])]}" required="1"/>
<!--                                 <field name="valid_from" attrs="{'readonly': [('state', 'not in', ['draft','submitted'])]}" required="1"/>
                                <field name="valid_to" attrs="{'readonly': [('state', 'not in', ['draft','submitted'])]}" required="1"/>
                                <field name="week_no" attrs="{'readonly': [('state', 'not in', ['draft','submitted'])]}" required="1"/>
                                <field name="tag_ids" widget="many2many_tags" attrs="{'readonly': [('state', 'not in', ['draft','submitted'])]}" options="{'no_quick_create':True,'no_create_edit':True}" invisible="1"/>
                                <field name="sold_via_id" attrs="{'readonly': [('state', 'not in', ['draft','submitted'])]}" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True}"/> -->
                            </group>
<!-- 
                            <group>
                                <field name="credit_limit" readonly="1" force_save="1"/>
                                <field name="credit_exposure" readonly="1" force_save="1"/>
                                <field name="remaining_credit" readonly="1" force_save="1"/>
                                <field name="open_so" readonly="1" force_save="1"/>
                                <field name="total_sales" readonly="1"/>
                                <field name="credit_after_sale" readonly="1" force_save="1"/>
                                <field name="ar_status" readonly="1" force_save="1"/>
                                <field name="error_count" invisible="1"/>
                                <field name="errors" invisible="1"/>
                            </group>
-->
                        </group>
<!-- 
                    <center attrs="{'invisible': [('error_count','=',0)]}">
                        <span style="color:red"><field name="errors_disp" readonly="1"/></span>
                    </center>
 -->
                    <notebook>
                        <page string="Customer Orders">
                            <field name="customer_order_ids" context="{'default_sap_doc_type':sap_doc_type}" attrs="{'readonly': [('state', 'not in', ['draft'])]}">
                                <tree>
                                    <field name="contract_line_no" string="#"/>
                                    <field name="ship_to_id" />
                                    <field name="notify_id" />
                                    <field name="ship_line" />
                                    <field name="destination" />
                                    <field name="total_p100" sum="Total" string="With Crown"/>
                                    <field name="total_p200" sum="Total" string="Crownless"/>
                                    <field name="total_qty" sum="Total" string="Qty"/>
                                    <field name="total_amount" sum="Total" string="Amount"/>
                                </tree>



                                <form class="o_form_document">
                                    <sheet>
                                        <group>
                                            <group>
                                                <field name="ship_to_id" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True}" required="1" domain="[('id','in',allowed_ship_to)]"/>
                                                <field name="notify_id" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True}" required="1" domain="[('id','in',allowed_ship_to)]"/>
                                                <field name="mailing_id" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True}" required="0" domain="[('id','in',allowed_ship_to)]" invisible="1"/>

                                                <field name="sap_doc_type" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True}" required="1" invisible="1"/>
                                                <field name="sales_org" required="1" invisible="1"/>
                                                <field name="plant" invisible="1"/>
                                                <field name="plant_id" required="1" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True}" invisible="1"/>
                                                <field name="tag_ids" widget="many2many_tags" invisible="1"/>
                                                <field name="week_no" invisible="1"/>
                                            </group>
                                            <group>
                                                <!-- <field name="valid" /> -->
                                                <field name="destination"  invisible="1"/>
                                                <field name="ship_line"  invisible="1"/>
                                                <field name="shell_color"  invisible="1"/>
                                                <field name="requested_delivery_date"  invisible="1"/>
                                                <field name="estimated_date"  invisible="1"/>
                                                <!-- <field name="sap_so_no" /> -->
                                                <field name="total_amount" invisible="1"/>
                                                <field name="total_qty" invisible="1"/>
                                                <field name="total_p100" invisible="1"/>
                                                <field name="total_p200" invisible="1"/>
                                                <field name="found_p60" invisible="1"/>
                                            </group>
                                        </group>
                                        
                                        <!--                                         
                                        <center>
                                            <field name="error" invisible="1" style="color:red"/>
                                            <span style="color:red"><field name="error_msg" readonly="1"/></span>
                                        </center>
                                        -->
                                        <field name="notes"  widget="html"/> 
                                        

                                        <notebook>
                                            <page string="Orders">
                                                <field name="order_ids">
                                                    <tree editable="bottom">
                                                        <field name="contract_line_no" readonly="1" string="CO#" invisible="1"/>
                                                        <field name="so_line_no" readonly="1" string="SO#"/>
                                                        <field name="product_id" options="{'no_create': True, 'no_open': True}" domain="[('id', 'in', parent.allowed_products)]" required="1"/>
                                                        <field name="product_code"/>
                                                        <field name="name" readonly="1"/>
                                                        <!-- <field name="pricing_date" invisible="0"/> -->
                                                        <!-- <field name="price" /> -->
                                                        <field name="uom" />
                                                        <field name="qty" sum='Total Qty'/>
                                                        <field name="found_p60" invisible="1"/>
                                                        <!-- <field name="total"  sum='Total Amount'/> -->
                                                    </tree>
                                                </field>                            
                                            </page>    

                                            <field name="allowed_ship_to" invisible="1"/>
                                            <field name="allowed_products" invisible="1"/>
<!-- 
                                            <page string="Settings">
                                                <group>
                                                    <group>
                                                        <field name="sap_so_no"/>
                                                        <field name="sap_so_date"/>
                                                        <field name="sap_doc_type"/>
                                                    </group>
                                                    <group>
                                                        <field name="contract_id" />
                                                        <field name="partner_id" />
                                                    </group>
                                                    <group>
                                                        <field name="pack_code_tmp"/>
                                                        <field name="contract_tag_ids"/>
                                                    </group>
                                                </group>
                                                <group>
                                                    <group>

                                                    </group>
                                                </group>
                                            </page> -->

                                        </notebook>
                                    </sheet>

                                    <div class="oe_chatter">
                                        <field name="message_follower_ids" widget="mail_followers"/>
                                        <field name="message_ids" widget="mail_thread"/>
                                    </div>
                                </form>





                            </field>
                        </page>
                        <page string="Sales Order">
                            <field name="sale_order_ids" context="{'default_sap_doc_type':sap_doc_type}" readonly="1" style="pointer-events:none;">
                                <tree>
                                    <field name="contract_line_no" string="#"/>
                                    <field name="name_disp" />
                                    <field name="ship_to_id" />
                                    <field name="notify_id" />
                                    <field name="ship_line" />
                                    <field name="destination" />
                                    <field name="total_p100" sum="Total"/>
                                    <field name="total_p200" sum="Total"/>
                                    <field name="total_qty" sum="Total" string="Qty"/>
                                    <field name="state"/>
                                </tree>
                            </field>
                            
                        </page>
                        <page string="Delivery">
                            <field name="dr_ids"  readonly="1" style="pointer-events:none;">
                                <tree editable='bottom'>
                                    <field name="sap_dr_no" />
                                    <field name="name" />
                                </tree>
                            </field>                            
                        </page>
                        <page string="Shipment">
                            <field name="shp_ids"  readonly="1" style="pointer-events:none;">
                                <tree editable='bottom'>
                                    <field name="shp_no" />
                                    <field name="sap_dr_no" />
                                </tree>
                            </field>                            
                        </page>

                        <page string="Invoice">
                            <field name="invoice_ids"  readonly="1" style="pointer-events:none;">
                                <tree>
                                    <field name="name" />
                                    <field name="dmpi_inv_no" />
                                </tree>
                            </field>                            
                        </page>

                        <field name="sap_doc_type" invisible="1"/>


                        <page string="Customer Notes">
                            <field name="note_ids">



                                <kanban>
                                    <field name="subject"/>
                                    <field name="body_html"/>
                                    <field name="attachment_ids"/>
                                    <templates>
                                        <t t-name="kanban-box">
                                            <div style="width: 100%;">
                                                <div class="row ">
                                                    <div class="col-16">
                                                        <ul>
                                                            <li>DATE: <field name="date"/></li>
                                                            <li>SUBJECT: <field name="subject"/></li>
                                                            <li><field name="body_html" widget="html"/></li>
                                                            <li><field name="attachment_ids" widget="many2many_binary"/></li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>

                                <form>
                                    <label for="subject"/>
                                    <h2 style="display: inline-block;"><field name="subject" placeholder="Subject (placeholders may be used here)"/></h2>
                                    <field name="body_html" widget="html" options="{'style-inline': true}"/>
                                    <field name="attachment_ids" widget="many2many_binary"/>
                                </form>
                            </field>
                        </page>


                    </notebook>



                    </sheet>
                </form>
            </field>
        </record>



    <record id="action_dmpi_crm_customer_contract" model="ir.actions.act_window">
        <field name="name">Contract</field>
        <field name="res_model">dmpi.crm.sale.contract</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[]</field>
        <!-- <field name="domain">[('partner_id', 'child_of', user.id.partner_ids.id)]</field> -->
        <!-- <field name="filter_domain">[('customer', '=', True)]</field> -->
        <!-- <field name="context">{'search_default_valid_today':1}</field> -->
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'tree', 'view_id': ref('view_dmpi_crm_sale_contract_customer_tree')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('view_dmpi_crm_sale_contract_customer_form')})]"/>
        <field name="search_view_id" ref="view_dmpi_crm_sale_contract_customer_search"/>
    </record>

    <menuitem id="menu_dmpi_crm_product_price_list_item_commercial" action="action_dmpi_crm_product_price_list_item_commercial" parent="menu_dmpi_crm_commercial_config"/>




    <menuitem id="menu_main_dmpi_customer_contract" name="Contracts" web_icon="dmpi_crm,static/description/icon.png" sequence="0"/>
    <!-- PURCHASES -->
    <menuitem id="menu_dmpi_crm_customer_contract_top" name="Contracts" parent="menu_main_dmpi_customer_contract" groups="dmpi_crm.group_custom_crm_customer" sequence="10"/>
    <menuitem id="menu_dmpi_crm_customer_contract" action="action_dmpi_crm_customer_contract" parent="menu_dmpi_crm_customer_contract_top"/>

</odoo>
